
/**
 * 由 Fantastic-admin 提供技術支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-DpYLhOHb.js";import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-BTce45WY.js";import{d as ce,r as c,m as x,n as j,a as fe,p as u,q as _e,g as C,c as T,b as e,w as l,h as d,F as ge,s as be,i as h,y as ve,z as S,t as k,e as v,B as ye,G as y,E as we,j as Ve,_ as Ce,k as D}from"./index-nGFMSQGw.js";import{A as U}from"./package-DNsyP8d5.js";import{i as he,I as ke}from"./index-BE-LteFu.js";import{u as Ue}from"./utcformatTime-Bq4gDWNx.js";const Ie=v("div",{class:"flex items-center gap-4"},"套餐設置",-1),xe=v("div",{class:"text-sm/6"},[v("div",null," 套餐分為不限時套餐和限時套餐。不限時充值積分永不過期，限時套餐在規定時間未使用完畢將清空剩餘積分。 "),v("div",null," 如果充值的套餐等級高於或等於當前套餐等級，則疊加充值額度並延長會員到期時間。 "),v("div",null," 如果充值的套餐等級低於當前套餐等級，則只疊加充值額度，不延長會員到期時間也不改變會員等級。 "),d(" 請仔細閱讀以上內容併合理配置，套餐有效時間設為-1即為不限時套餐。 ")],-1),Me={class:"mr-5 flex justify-end"},qe=ce({__name:"package",setup(ze){const B=c(`/api/upload/file?dir=${encodeURIComponent("system/others")}`),M=c(),q=c(0),b=c(!1),w=c(!1),m=x({name:"",page:1,size:10,status:""}),V=c(),f=c(0),o=x({name:null,des:null,coverImg:null,price:null,order:null,status:null,weight:null,days:null,model3Count:null,model4Count:null,drawMjCount:null}),F=x({name:[{required:!0,message:"請填寫套餐名稱",trigger:"blur"}],des:[{required:!0,message:"請填寫套餐的詳細描述",trigger:"blur"}],deductionType:[{required:!0,message:"請選擇扣費形式",trigger:"change"}],coverImg:[{required:!0,message:"請填寫或上傳封面圖地址",trigger:"blur"}],price:[{required:!0,message:"請填寫套餐價格",trigger:"blur"}],order:[{required:!0,message:"請填寫套餐排序",trigger:"blur"}],status:[{required:!0,message:"請選擇套餐開啟狀態",trigger:"change"}],days:[{required:!0,message:"請填寫套餐有效期天數",trigger:"blur"}],model3Count:[{required:!0,message:"請填寫套餐中基礎模型可使用次數",trigger:"blur"}],model4Count:[{required:!0,message:"請填寫套餐中高級模型可使用次數",trigger:"blur"}],drawMjCount:[{required:!0,message:"請填寫套餐中抽獎次數",trigger:"blur"}]}),z=c([]);async function _(){try{w.value=!0;const n=await U.queryAllPackage(m);w.value=!1;const{rows:a,count:I}=n.data;q.value=I,z.value=a}catch{w.value=!1}}function N(n){n==null||n.resetFields(),_()}const R=n=>{if(["image/png","image/jpeg","image/gif","image/webp"].includes(n.type)){if(n.size/1024>2e3)return y.error("當前限制文件最大不超過 2000KB!"),!1}else return y.error("當前系統僅支持 PNG、JPEG、GIF、和 WebP 格式的圖片!"),!1;return!0},G=(n,a)=>{o.coverImg=n.data};async function O(n){await U.delPackage({id:n}),y({type:"success",message:"刪除套餐成功！"}),_()}function Y(n){f.value=n.id,we(()=>{Object.assign(o,n),o==null||delete o.createdAt,o==null||delete o.updatedAt,o==null||delete o.deletedAt,o==null||delete o.id}),b.value=!0}const H=j(()=>f.value?"更新套餐":"新增套餐"),K=j(()=>f.value?"確認更新":"確認新增");function L(){var n;f.value=0,b.value=!0,(n=V.value)==null||n.resetFields()}function J(n){f.value=0,n==null||n.resetFields()}async function W(n){n==null||n.validate(async a=>{a&&(f.value?(await U.updatePackage({id:f.value,...o}),y({type:"success",message:"更新套餐成功！"})):(await U.createPackage(o),y({type:"success",message:"創建新的套餐成功！"})),b.value=!1,_())})}return fe(()=>{_()}),(n,a)=>{const I=Ve,Q=Ce,X=me,Z=u("el-option"),E=u("el-select"),r=u("el-form-item"),g=u("el-button"),A=u("el-form"),P=pe,s=u("el-table-column"),ee=u("el-image"),le=u("el-tag"),te=u("el-popconfirm"),ae=u("el-table"),oe=u("el-pagination"),$=u("el-row"),i=u("el-input"),p=u("el-col"),ne=u("el-switch"),ue=u("el-icon"),re=u("el-upload"),se=u("el-dialog"),de=_e("loading");return C(),T("div",null,[e(X,null,{title:l(()=>[Ie]),content:l(()=>[xe]),default:l(()=>[e(Q,{outline:"",onClick:L},{default:l(()=>[e(I,{name:"ic:baseline-plus"}),d(" 創建套餐 ")]),_:1})]),_:1}),e(P,null,{default:l(()=>[e(A,{ref_key:"formRef",ref:M,inline:!0,model:m},{default:l(()=>[e(r,{label:"套餐狀態",prop:"status"},{default:l(()=>[e(E,{modelValue:m.status,"onUpdate:modelValue":a[0]||(a[0]=t=>m.status=t),placeholder:"請選擇套餐狀態",clearable:"",style:{width:"160px"}},{default:l(()=>[(C(!0),T(ge,null,be(h(he),t=>(C(),S(Z,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(g,{type:"primary",onClick:_},{default:l(()=>[d(" 查詢 ")]),_:1}),e(g,{onClick:a[1]||(a[1]=t=>N(M.value))},{default:l(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,{style:{width:"100%"}},{default:l(()=>[ve((C(),S(ae,{border:"",data:z.value,style:{width:"100%"},size:"large"},{default:l(()=>[e(s,{fixed:"",prop:"name",label:"套餐名稱",width:"150"}),e(s,{prop:"order",label:"排序ID",align:"center",width:"100"}),e(s,{prop:"coverImg",label:"套餐封面",width:"150",align:"center"},{default:l(t=>[e(ee,{style:{height:"50px"},src:t.row.coverImg,fit:"fill"},null,8,["src"])]),_:1}),e(s,{prop:"price",label:"套餐價格",width:"100",align:"center"}),e(s,{prop:"weight",label:"套餐等級",width:"100",align:"center"}),e(s,{prop:"status",label:"套餐狀態",width:"100"},{default:l(t=>[e(le,{type:"info"},{default:l(()=>[d(k(h(ke)[t.row.status]),1)]),_:2},1024)]),_:1}),e(s,{prop:"days",label:"套餐有效期",width:"120"},{default:l(t=>[d(k(t.row.days>0?`${t.row.days}天`:"永久"),1)]),_:1}),e(s,{prop:"model3Count",label:"基礎模型額度",width:"100"}),e(s,{prop:"model4Count",label:"高級模型額度",width:"100"}),e(s,{prop:"drawMjCount",label:"繪畫額度",width:"100"}),e(s,{prop:"des",label:"套餐描述",width:"300"}),e(s,{prop:"createdAt",label:"創建時間",width:"200"},{default:l(t=>[d(k(h(Ue)(t.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),e(s,{fixed:"right",label:"操作",width:"200"},{default:l(t=>[e(g,{link:"",type:"primary",size:"small",onClick:ie=>Y(t.row)},{default:l(()=>[d(" 修改套餐 ")]),_:2},1032,["onClick"]),e(te,{title:"確認刪除此套餐麼?",width:"200","icon-color":"red",onConfirm:ie=>O(t.row)},{reference:l(()=>[e(g,{link:"",type:"danger",size:"small"},{default:l(()=>[d(" 刪除套餐 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])),[[de,w.value]]),e($,{class:"mt-5 flex justify-end"},{default:l(()=>[e(oe,{"current-page":m.page,"onUpdate:currentPage":a[2]||(a[2]=t=>m.page=t),"page-size":m.size,"onUpdate:pageSize":a[3]||(a[3]=t=>m.size=t),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:q.value,onSizeChange:_,onCurrentChange:_},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),e(se,{modelValue:b.value,"onUpdate:modelValue":a[17]||(a[17]=t=>b.value=t),"close-on-click-modal":!1,title:H.value,width:"970",onClose:a[18]||(a[18]=t=>J(V.value))},{footer:l(()=>[v("span",Me,[e(g,{onClick:a[15]||(a[15]=t=>b.value=!1)},{default:l(()=>[d("取消")]),_:1}),e(g,{type:"primary",onClick:a[16]||(a[16]=t=>W(V.value))},{default:l(()=>[d(k(K.value),1)]),_:1})])]),default:l(()=>[e(A,{ref_key:"formPackageRef",ref:V,"label-position":"right","label-width":"120px",model:o,rules:F},{default:l(()=>[e($,null,{default:l(()=>[e(p,{span:11},{default:l(()=>[e(r,{label:"套餐詳細名稱",prop:"name"},{default:l(()=>[e(i,{modelValue:o.name,"onUpdate:modelValue":a[4]||(a[4]=t=>o.name=t),placeholder:"請填寫套餐名稱"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:3,offset:2},{default:l(()=>[e(r,{label:"套餐開啟狀態",prop:"status"},{default:l(()=>[e(ne,{modelValue:o.status,"onUpdate:modelValue":a[5]||(a[5]=t=>o.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:7,offset:1},{default:l(()=>[e(r,{label:"套餐等級",prop:"status"},{default:l(()=>[e(i,{modelValue:o.weight,"onUpdate:modelValue":a[6]||(a[6]=t=>o.weight=t),modelModifiers:{number:!0},type:"number",placeholder:"設置套餐等級"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:11},{default:l(()=>[e(r,{label:"設置套餐價格",prop:"price"},{default:l(()=>[e(i,{modelValue:o.price,"onUpdate:modelValue":a[7]||(a[7]=t=>o.price=t),modelModifiers:{number:!0},placeholder:"請填寫套餐價格(NT$)",type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:11,offset:2},{default:l(()=>[e(r,{label:"套餐有效時間",prop:"days"},{default:l(()=>[e(i,{modelValue:o.days,"onUpdate:modelValue":a[8]||(a[8]=t=>o.days=t),modelModifiers:{number:!0},type:"number",placeholder:"自序號生成之日有效天數、-1為永久"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:9},{default:l(()=>[e(r,{label:"設置套餐封面",prop:"coverImg"},{default:l(()=>[e(i,{modelValue:o.coverImg,"onUpdate:modelValue":a[9]||(a[9]=t=>o.coverImg=t),class:"flex-1",placeholder:"填寫封面地址或點擊上傳"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:2},{default:l(()=>[e(re,{class:"avatar-uploader",action:B.value,"show-file-list":!1,"on-success":G,"before-upload":R},{default:l(()=>[e(g,null,{default:l(()=>[e(ue,null,{default:l(()=>[e(h(ye))]),_:1})]),_:1})]),_:1},8,["action"])]),_:1}),e(p,{span:11,offset:2},{default:l(()=>[e(r,{label:"設置套餐排序",prop:"order"},{default:l(()=>[e(i,{modelValue:o.order,"onUpdate:modelValue":a[10]||(a[10]=t=>o.order=t),modelModifiers:{number:!0},type:"number",placeholder:"排序數字越大越靠前|套餐權重等級則反之"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:11},{default:l(()=>[e(r,{label:"設置套餐描述",prop:"des"},{default:l(()=>[e(i,{modelValue:o.des,"onUpdate:modelValue":a[11]||(a[11]=t=>o.des=t),type:"textarea",placeholder:"請填寫套餐詳細介紹資訊、用於對外展示、建議控制套餐價格字數以便於用戶端對齊格式...",rows:6},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:11,offset:2},{default:l(()=>[e(r,{label:"基礎模型積分",prop:"model3Count"},{default:l(()=>[e(i,{modelValue:o.model3Count,"onUpdate:modelValue":a[12]||(a[12]=t=>o.model3Count=t),modelModifiers:{number:!0},type:"number",placeholder:"基礎模型積分"},null,8,["modelValue"])]),_:1}),e(r,{label:"高級模型積分",prop:"model4Count"},{default:l(()=>[e(i,{modelValue:o.model4Count,"onUpdate:modelValue":a[13]||(a[13]=t=>o.model4Count=t),modelModifiers:{number:!0},type:"number",placeholder:"高級模型積分"},null,8,["modelValue"])]),_:1}),e(r,{label:"繪畫模型積分",prop:"drawMjCount"},{default:l(()=>[e(i,{modelValue:o.drawMjCount,"onUpdate:modelValue":a[14]||(a[14]=t=>o.drawMjCount=t),modelModifiers:{number:!0},type:"number",placeholder:"繪畫模型積分"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});typeof D=="function"&&D(qe);export{qe as default};
