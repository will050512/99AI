
/**
 * 由 Fantastic-admin 提供技術支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as pe}from"./index.vue_vue_type_script_setup_true_lang-DpYLhOHb.js";import{_ as me}from"./index.vue_vue_type_script_setup_true_lang-BTce45WY.js";import{d as ce,r as _,m as x,a as fe,p as u,q as _e,g as w,c as z,b as l,w as t,F as G,s as H,i as k,h as r,y as be,z as j,t as p,e as I,K as U,G as D,k as K}from"./index-nGFMSQGw.js";import{k as J}from"./index-BE-LteFu.js";import{u as Q}from"./utcformatTime-Bq4gDWNx.js";const ge=I("div",{class:"flex items-center gap-4"},"用戶資訊列表",-1),we={class:"input-with-text"},ve={class:"input-with-text"},Ce={class:"input-with-text"},ye=ce({__name:"index",setup(he){const A=_(),R=_(0),y=_(!1),h=_(!1),v=_(!1),M=_(0),S=_(),g=x({status:"0",id:0}),m=x({model3Count:0,model4Count:0,drawMjCount:0}),i=x({username:"",email:"",status:"",phone:"",page:1,size:15}),W={0:"Inactive",1:"Active",2:"Banned",3:"Suspended"},X=x({model3Count:[{required:!0,message:"請填寫調整的基礎模型額度",trigger:"blur"}],model4Count:[{required:!0,message:"請填寫調整的高級模型額度",trigger:"blur"}],drawMjCount:[{required:!0,message:"請填寫調整的繪畫積分額度",trigger:"blur"}]}),q=_([]);async function b(){try{h.value=!0;const n=await U.queryAllUser(i),{rows:a,count:C}=n.data;h.value=!1,R.value=C,q.value=a}catch{h.value=!1}}function Z(n){y.value=!0,g.status=n.status.toString(),g.id=n.id}function E(n){v.value=!0,M.value=n.id}async function ee(){(await U.updateUserStatus(g)).success&&D({type:"success",message:"變更用戶狀態成功！"}),y.value=!1,b()}function le(n){n==null||n.resetFields(),b()}async function te(n){const{id:a,email:C}=n;(await U.resetUserPassword({id:a})).success&&D({type:"success",message:`重置用戶[${C}密碼為初始密碼為[123456]完成！`})}function ae(n){M.value=0,n==null||n.resetFields()}async function ne(n){n==null||n.validate(async a=>{a&&(await U.sendUserCrami({...m,userId:M.value}),D.success("調整成功！"),v.value=!1,b())})}return fe(()=>b()),(n,a)=>{const C=me,V=u("el-input"),d=u("el-form-item"),N=u("el-option"),P=u("el-select"),c=u("el-button"),T=u("el-form"),B=pe,oe=u("el-avatar"),s=u("el-table-column"),L=u("el-tag"),se=u("el-popconfirm"),re=u("el-table"),ue=u("el-pagination"),ie=u("el-row"),F=u("el-dialog"),$=u("el-input-number"),de=_e("loading");return w(),z("div",null,[l(C,null,{title:t(()=>[ge]),_:1}),l(B,null,{default:t(()=>[l(T,{ref_key:"formRef",ref:A,inline:!0,model:i},{default:t(()=>[l(d,{label:"用戶名稱",prop:"username"},{default:t(()=>[l(V,{modelValue:i.username,"onUpdate:modelValue":a[0]||(a[0]=e=>i.username=e),placeholder:"用戶姓名[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"用戶郵箱",prop:"email"},{default:t(()=>[l(V,{modelValue:i.email,"onUpdate:modelValue":a[1]||(a[1]=e=>i.email=e),placeholder:"用戶郵箱[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"手機號碼",prop:"phone"},{default:t(()=>[l(V,{modelValue:i.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>i.phone=e),placeholder:"手機號碼[模糊搜索]",clearable:""},null,8,["modelValue"])]),_:1}),l(d,{label:"用戶狀態",prop:"status"},{default:t(()=>[l(P,{modelValue:i.status,"onUpdate:modelValue":a[3]||(a[3]=e=>i.status=e),placeholder:"請選擇用戶狀態",style:{width:"160px"},clearable:""},{default:t(()=>[(w(!0),z(G,null,H(k(J),e=>(w(),j(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(c,{type:"primary",onClick:b},{default:t(()=>[r(" 查詢 ")]),_:1}),l(c,{onClick:a[4]||(a[4]=e=>le(A.value))},{default:t(()=>[r(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(B,{style:{width:"100%"}},{default:t(()=>[be((w(),j(re,{border:"",data:q.value,style:{width:"100%"},size:"large"},{default:t(()=>[l(s,{prop:"avatar",label:"用戶頭像",fixed:"",width:"120"},{default:t(e=>[l(oe,{src:e.row.avatar},null,8,["src"])]),_:1}),l(s,{fixed:"",prop:"username",label:"用戶名稱",width:"150"}),l(s,{prop:"email",label:"用戶郵箱",width:"250",align:"left"}),l(s,{prop:"phone",label:"用戶手機號",width:"250",align:"left"},{default:t(e=>{var o;return[r(p(((o=e.row)==null?void 0:o.phone)||"未綁定手機號"),1)]}),_:1}),l(s,{prop:"realName",label:"真實姓名",width:"150",align:"center"},{default:t(e=>{var o;return[r(p(((o=e.row)==null?void 0:o.realName)||"未實名認證"),1)]}),_:1}),l(s,{prop:"idCard",label:"身份證號",width:"200",align:"center"},{default:t(e=>{var o;return[r(p(((o=e.row)==null?void 0:o.idCard)||"未實名認證"),1)]}),_:1}),l(s,{prop:"status",label:"用戶狀態",width:"120",align:"center"},{default:t(({row:e})=>[l(L,{type:"success"},{default:t(()=>[r(p(W[e.status]),1)]),_:2},1024)]),_:1}),l(s,{prop:"balanceInfo.model3Count",label:"基礎模型",width:"120",align:"center"}),l(s,{prop:"balanceInfo.model4Count",label:"高級模型",width:"120",align:"center"}),l(s,{prop:"balanceInfo.drawMjCount",label:"繪畫餘額",width:"120",align:"center"}),r("expirationTime "),l(s,{prop:"balanceInfo.drawMjCount",label:"會員到期時間",width:"170",align:"center"},{default:t(e=>[l(L,{type:"success"},{default:t(()=>{var o,f,Y,O;return[r(p((f=(o=e.row)==null?void 0:o.balanceInfo)!=null&&f.expirationTime?k(Q)(new Date((O=(Y=e.row)==null?void 0:Y.balanceInfo)==null?void 0:O.expirationTime).toString()):"非會員"),1)]}),_:2},1024)]),_:1}),l(s,{prop:"balanceInfo.memberModel3Count",label:"基礎模型[會員]",width:"120",align:"center"}),l(s,{prop:"balanceInfo.memberModel4Count",label:"高級模型[會員]",width:"120",align:"center"}),l(s,{prop:"balanceInfo.memberDrawMjCount",label:"繪畫餘額[會員]",width:"120",align:"center"}),l(s,{prop:"balanceInfo.useModel3Count",label:"已用基礎模型",width:"160",align:"center"},{default:t(e=>{var o,f;return[r(p(`${((o=e.row.balanceInfo)==null?void 0:o.useModel3Count)||0}次 | ${((f=e.row.balanceInfo)==null?void 0:f.useModel3Token)||0} Token`),1)]}),_:1}),l(s,{prop:"balanceInfo.useModel4Count",label:"已用高級模型",width:"160",align:"center"},{default:t(e=>{var o,f;return[r(p(`${((o=e.row.balanceInfo)==null?void 0:o.useModel4Count)||0}次 | ${((f=e.row.balanceInfo)==null?void 0:f.useModel4Token)||0} Token`),1)]}),_:1}),l(s,{prop:"balanceInfo.useDrawMjToken",label:"已用繪畫積分",width:"160",align:"center"},{default:t(e=>{var o;return[r(p(`${((o=e.row.balanceInfo)==null?void 0:o.useDrawMjToken)||0} Token`),1)]}),_:1}),l(s,{prop:"createdAt",label:"註冊時間",width:"200",align:"center"},{default:t(e=>[r(p(k(Q)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),l(s,{fixed:"right",label:"操作",width:"250",align:"center"},{default:t(e=>[l(c,{link:"",type:"primary",size:"small",onClick:o=>Z(e.row)},{default:t(()=>[r(" 修改狀態 ")]),_:2},1032,["onClick"]),l(se,{title:"確認重置此用戶密碼為【123456】?","confirm-button-text":"確認重置",onConfirm:o=>te(e.row)},{reference:t(()=>[l(c,{link:"",type:"danger"},{default:t(()=>[r(" 重置密碼 ")]),_:1})]),_:2},1032,["onConfirm"]),l(c,{link:"",type:"primary",size:"small",onClick:o=>E(e.row)},{default:t(()=>[r(" 調整積分 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,h.value]]),l(ie,{class:"mt-5 flex justify-end"},{default:t(()=>[l(ue,{"current-page":i.page,"onUpdate:currentPage":a[5]||(a[5]=e=>i.page=e),"page-size":i.size,"onUpdate:pageSize":a[6]||(a[6]=e=>i.size=e),class:"mr-5","page-sizes":[15,30,50,100],layout:"total, sizes, prev, pager, next, jumper",total:R.value,onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),l(F,{modelValue:y.value,"onUpdate:modelValue":a[8]||(a[8]=e=>y.value=e),title:"變更用戶狀態",width:"500px"},{default:t(()=>[l(T,{model:g,inline:!0},{default:t(()=>[l(d,{label:"用戶狀態","label-width":"90px"},{default:t(()=>[l(P,{modelValue:g.status,"onUpdate:modelValue":a[7]||(a[7]=e=>g.status=e),placeholder:"請選擇用戶狀態",style:{width:"160px"},clearable:""},{default:t(()=>[(w(!0),z(G,null,H(k(J),e=>(w(),j(N,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:t(()=>[l(c,{type:"primary",onClick:ee},{default:t(()=>[r(" 確認變更 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(F,{modelValue:v.value,"onUpdate:modelValue":a[14]||(a[14]=e=>v.value=e),title:"調整用戶積分（贈送/扣除）",width:"450px",onClose:a[15]||(a[15]=e=>ae(S.value))},{footer:t(()=>[l(c,{onClick:a[12]||(a[12]=e=>v.value=!1)},{default:t(()=>[r(" 取消 ")]),_:1}),l(c,{type:"primary",onClick:a[13]||(a[13]=e=>ne(S.value))},{default:t(()=>[r(" 確認調整 ")]),_:1})]),default:t(()=>[l(T,{ref_key:"cramiRef",ref:S,model:m,rules:X,"label-width":"100px"},{default:t(()=>[l(d,{label:"基礎積分",prop:"modelLimits"},{default:t(()=>[I("div",we,[l($,{modelValue:m.model3Count,"onUpdate:modelValue":a[9]||(a[9]=e=>m.model3Count=e),max:99999,min:-99999,step:1,"step-strictly":"",class:"input-number",style:{"margin-right":"10px"}},null,8,["modelValue"])])]),_:1}),l(d,{label:"高級積分",prop:"modelLimits"},{default:t(()=>[I("div",ve,[l($,{modelValue:m.model4Count,"onUpdate:modelValue":a[10]||(a[10]=e=>m.model4Count=e),max:99999,min:-99999,step:1,"step-strictly":"",class:"input-number",style:{"margin-right":"10px"}},null,8,["modelValue"])])]),_:1}),l(d,{label:"繪畫積分",prop:"modelLimits"},{default:t(()=>[I("div",Ce,[l($,{modelValue:m.drawMjCount,"onUpdate:modelValue":a[11]||(a[11]=e=>m.drawMjCount=e),max:99999,min:-99999,step:1,"step-strictly":"",class:"input-number",style:{"margin-right":"10px"}},null,8,["modelValue"])])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});typeof K=="function"&&K(ye);export{ye as default};
