
/**
 * 由 Fantastic-admin 提供技術支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.github.io
 */

import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang-DpYLhOHb.js";import{_ as X}from"./index.vue_vue_type_script_setup_true_lang-BTce45WY.js";import{A as Z}from"./badWords-C1vgC_-i.js";import{d as ee,r as f,m as P,a as te,p as o,q as le,g as c,c as h,b as t,w as l,F as T,s as V,i as s,h as d,y as ae,z as S,e as C,t as m,D as ne,K as L,G as oe,k as Y}from"./index-nGFMSQGw.js";import{u as se}from"./utcformatTime-Bq4gDWNx.js";import{m as z}from"./marked.esm-8ZxQ78w7.js";import{T as re,U as ie,j as ue,k as de}from"./index-BE-LteFu.js";const pe=C("div",{class:"flex items-center gap-4"},"違規檢測記錄",-1),ce=["src"],_e={class:"answer"},fe=["innerHTML"],me=ee({__name:"violation",setup(ge){const j=new z.Renderer;z.setOptions({renderer:j,gfm:!0,pedantic:!1});const v=f(!1),A=f(),O=f(),R=f(0),i=P({userId:"",typeOriginCn:"",page:1,size:10}),M=f([]),g=f(!1),_=P({status:"0",id:0});function B(n){g.value=!0,_.status=n.status.toString(),_.id=n.userId}async function q(){(await L.updateUserStatus(_)).success&&oe({type:"success",message:"變更用戶狀態成功！"}),g.value=!1}async function w(){v.value=!0;try{const n=await Z.queryViolation(i);v.value=!1;const{rows:a,count:U}=n.data;R.value=U,M.value=a}catch{v.value=!1}}async function $(n){const a=await L.queryAllUser({size:30,username:n});A.value=a.data.rows}function E(n){n==null||n.resetFields(),w()}return te(()=>{w()}),(n,a)=>{const U=X,k=o("el-option"),I=o("el-select"),y=o("el-form-item"),b=o("el-button"),D=o("el-form"),N=Q,r=o("el-table-column"),x=o("el-tag"),F=o("el-popover"),H=o("el-table"),G=o("el-pagination"),J=o("el-row"),K=o("el-dialog"),W=le("loading");return c(),h("div",null,[t(U,null,{title:l(()=>[pe]),_:1}),t(N,null,{default:l(()=>[t(D,{ref_key:"formRef",ref:O,inline:!0,model:i},{default:l(()=>[t(y,{label:"用戶名稱",prop:"userId"},{default:l(()=>[t(I,{modelValue:i.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>i.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用戶姓名[模糊搜索]","remote-show-suffix":"","remote-method":$,style:{width:"160px"}},{default:l(()=>[(c(!0),h(T,null,V(s(A),e=>(c(),S(k,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"檢測平臺",prop:"typeOriginCn"},{default:l(()=>[t(I,{modelValue:i.typeOriginCn,"onUpdate:modelValue":a[1]||(a[1]=e=>i.typeOriginCn=e),placeholder:"請選擇檢測平臺",clearable:"",style:{width:"160px"}},{default:l(()=>[(c(!0),h(T,null,V(s(re),e=>(c(),S(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(b,{type:"primary",onClick:w},{default:l(()=>[d(" 查詢 ")]),_:1}),t(b,{onClick:a[2]||(a[2]=e=>E(s(O)))},{default:l(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{style:{width:"100%"}},{default:l(()=>[ae((c(),S(H,{border:"",data:s(M),style:{width:"100%"},size:"large","tooltip-options":{}},{default:l(()=>[t(r,{fixed:"",prop:"userInfo.username",label:"用戶名稱",width:"150"}),t(r,{prop:"userInfo.avatar",label:"頭像",width:"120"},{default:l(e=>{var u,p;return[C("img",{src:(p=(u=e.row)==null?void 0:u.userInfo)==null?void 0:p.avatar,style:{height:"50px"}},null,8,ce)]}),_:1}),t(r,{prop:"userInfo.email",label:"郵箱",width:"200"}),t(r,{prop:"status",label:"用戶狀態",width:"120",align:"center"},{default:l(({row:e})=>[t(x,{type:s(ie)[e.userInfo.status]},{default:l(()=>[d(m(s(ue)[e.userInfo.status]),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"userInfo.violationCount",label:"累計次數",width:"90",align:"center"}),t(r,{label:"違規類型"},{default:l(e=>[t(x,{type:"danger"},{default:l(()=>{var u,p;return[d(m((u=e.row)!=null&&u.typeCn?JSON.parse((p=e.row)==null?void 0:p.typeCn).join("  |  "):""),1)]}),_:2},1024)]),_:1}),t(r,{label:"違規關鍵詞"},{default:l(e=>{var u,p;return[d(m((u=e.row)!=null&&u.words?JSON.parse((p=e.row)==null?void 0:p.words).join("  |  "):""),1)]}),_:1}),t(r,{prop:"typeOriginCn",label:"違規檢測來源",width:"120"},{default:l(e=>[t(x,{type:"success"},{default:l(()=>[d(m(e.row.typeOriginCn),1)]),_:2},1024)]),_:1}),t(r,{prop:"answer",label:"違規內容",width:"200"},{default:l(e=>[t(F,{placement:"top",width:400,trigger:"click"},{reference:l(()=>[C("div",_e,m(e.row.content),1)]),default:l(()=>[C("div",{class:"answer_container",innerHTML:s(z)(e.row.content||"")},null,8,fe)]),_:2},1024)]),_:1}),t(r,{prop:"createdAt",label:"違規時間",width:"200"},{default:l(e=>[d(m(s(se)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(r,{fixed:"right",label:"操作",width:"120",align:"center"},{default:l(e=>[t(b,{link:"",type:"primary",size:"small",onClick:u=>B(e.row)},{default:l(()=>[d(" 變更用戶狀態 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,s(v)]]),t(J,{class:"mt-5 flex justify-end"},{default:l(()=>[t(G,{"current-page":i.page,"onUpdate:currentPage":a[3]||(a[3]=e=>i.page=e),"page-size":i.size,"onUpdate:pageSize":a[4]||(a[4]=e=>i.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:s(R),onSizeChange:w,onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(K,{modelValue:s(g),"onUpdate:modelValue":a[6]||(a[6]=e=>ne(g)?g.value=e:null),title:"變更用戶狀態",width:"500px"},{default:l(()=>[t(D,{model:_,inline:!0},{default:l(()=>[t(y,{label:"用戶狀態","label-width":"90px"},{default:l(()=>[t(I,{modelValue:_.status,"onUpdate:modelValue":a[5]||(a[5]=e=>_.status=e),placeholder:"請選擇用戶狀態",clearable:"",style:{width:"160px"}},{default:l(()=>[(c(!0),h(T,null,V(s(de),e=>(c(),S(k,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(b,{type:"primary",onClick:q},{default:l(()=>[d(" 確認變更 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});typeof Y=="function"&&Y(me);export{me as default};
